{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import SimpleLightbox from 'simplelightbox';\nimport 'simplelightbox/dist/simple-lightbox.min.css';\nimport axios from 'axios';\nimport iziToast from 'izitoast';\nimport 'izitoast/dist/css/iziToast.min.css';\n\nconst refs = {\n  gallery: document.querySelector('.gallery'),\n  form: document.querySelector('.search-form'),\n  loadBtn: document.querySelector('.load-more'),\n};\n\nconst simplelightbox = new SimpleLightbox('.gallery a', {});\nconst perPage = 40; /* Amount of images per page */\nlet page = 1;\nlet searchQuery = null; /* Client's input */\n\nrefs.loadBtn.addEventListener('click', async () => {\n  page += 1;\n  const resp = await fetchImages(page, searchQuery);\n  makeCards(resp);\n  if (page === Math.ceil(resp.data.totalHits / perPage)) {\n    refs.loadBtn.classList.add('hidden');\n    iziToast.show({\n      message: \"We're are sorry, but you've reached the end of search results.\",\n      position: 'topRight',\n    });\n    return;\n  }\n});\n\nrefs.form.addEventListener('submit', async event => {\n  event.preventDefault();\n  refs.loadBtn.classList.add('hidden');\n  refs.gallery.innerHTML = '';\n  page = 1;\n  searchQuery = event.target.elements.searchQuery.value.trim();\n\n  if (!searchQuery) {\n    iziToast.show({\n      message: 'Request is empty. Please enter something.',\n      position: 'topRight',\n    });\n    return;\n  }\n  try {\n    const resp = await fetchImages(page, searchQuery);\n    if (resp.data.totalHits === 0) {\n      refs.loadBtn.classList.add('hidden');\n      iziToast.show({\n        message:\n          'Sorry, there are no images matching your search query. Please try again!',\n        position: 'topRight',\n      });\n      return;\n    }\n    iziToast.show({\n      message: `Hooray! We found ${resp.data.totalHits} images.`,\n      position: 'topRight',\n    });\n    makeCards(resp);\n  } catch (error) {\n    console.log(`Error happend: ${error}`);\n  }\n});\n\nasync function fetchImages(pag, searchQuery) {\n  const params = new URLSearchParams({\n    key: '41029112-ec6e065fca3f0d308b81a7ee5',\n    q: searchQuery,\n    image_type: 'photo',\n    orientation: 'horizontal',\n    safesearch: true,\n    page: pag,\n    per_page: perPage,\n  });\n\n  try {\n    return await axios.get(`https://pixabay.com/api/?${params}`);\n  } catch (error) {\n    iziToast.show({\n      message: 'Error fetching images',\n    });\n  }\n}\n\nasync function makeCards(response) {\n  response.data.totalHits <= perPage\n    ? refs.loadBtn.classList.add('hidden')\n    : refs.loadBtn.classList.remove('hidden');\n\n  const markup = response.data.hits\n    .map(\n      ({\n        webformatURL,\n        largeImageURL,\n        tags,\n        likes,\n        views,\n        comments,\n        downloads,\n      }) => {\n        return `<a href=\"${largeImageURL}\"><div class=\"photo-card\">\n  <span class=\"loader\"></span>\n  <img class=\"image\" src=\"${webformatURL}\" alt=\"${tags}\"  />\n  <div class=\"info\">\n    <p class=\"info-item\">\n      <b>Likes</b><br>${likes}\n    </p>\n    <p class=\"info-item\">\n      <b>Views</b><br>${views}\n    </p>\n    <p class=\"info-item\">\n      <b>Comments</b><br>${comments}\n    </p>\n    <p class=\"info-item\">\n      <b>Downloads</b><br>${downloads}\n    </p>\n  </div>\n  </div></a>`;\n      }\n    )\n    .join('');\n  refs.gallery.insertAdjacentHTML('beforeend', markup);\n\n  refs.images = document.querySelectorAll('.image');\n  [...refs.images].map(image =>\n    image.addEventListener('load', async event => {\n      const loader = event.target.previousElementSibling;\n      if (loader !== null) {\n        loader.classList.add('loader-hidden');\n\n        loader.addEventListener('transitionend', () => {\n          loader.remove();\n        });\n      }\n    })\n  );\n\n  simplelightbox.refresh();\n\n  const { height: cardHeight } =\n    refs.gallery.firstElementChild.getBoundingClientRect();\n\n  window.scrollBy({\n    top: cardHeight / 2,\n    behavior: 'smooth',\n  });\n}\n"],"names":["refs","simplelightbox","SimpleLightbox","perPage","page","searchQuery","resp","fetchImages","makeCards","iziToast","event","error","pag","params","axios","response","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","image","loader","cardHeight"],"mappings":"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"}